# language: zh-TW
功能: 在每次新 session 中拼湊可控脈絡，維持乾淨的推理過程

  背景:
    假設 Bot 會在執行時從平台下載過往訊息
    而且會用關鍵字檢索找出關聯訊息
    而且 Bot 不會把 Agent 的所有中間輸出送到對外平台
    而是只在最後透過特定 skill 發送最終回覆

  情境: 初始脈絡由三類資料組成
    當 Bot 開始一次回覆流程
    那麼系統必須組裝初始脈絡
    而且初始脈絡至少包含
      | 類型 | 來源 | 上限 |
      | 記憶 | working directory 內的記憶檔案 | 由重要性/檢索規則決定 |
      | 頻道近期訊息 | 同一 channel 最近 20 則 | 固定 20 |
      | 同 guild 的近期互動 | 同一 guild 中與本次互動相關的近期內容 | 設定檔可調 |

  情境: Agent 可在過程中決定是否要拉更多資訊
    假設初始脈絡已提供
    當 Agent 判斷需要更多上下文
    那麼 Agent 可以呼叫 "platform.fetch_more_context" 類型的 skill
    而且 Bot 必須把 skill 回傳內容注入當次 session 的上下文
    而且不會把這些中間內容直接對外發送

  情境: 不建立記憶壓縮整理功能
    當 Bot 組裝脈絡時
    那麼系統不得對記憶內容做自動摘要或壓縮
    而且只能靠固定配額與檢索結果上限避免上下文膨脹

  情境: /clear 指令清除對話脈絡
    假設系統正在提取近期頻道訊息作為脈絡
    當任一訊息內容以 "/clear" 開頭
    那麼系統必須丟棄該訊息及其之前的所有訊息
    而且只保留 "/clear" 之後的訊息作為脈絡
    而且若有多筆 "/clear" 訊息，以最後一筆為準
    而且 "/clear" 訊息本身不會出現在最終脈絡中

  情境: /clear 指令不影響記憶與關聯訊息
    假設系統正在組裝初始脈絡
    當近期訊息中含有 "/clear" 指令
    那麼 "/clear" 僅影響近期頻道訊息的截斷
    而且不影響記憶檔案的載入
    而且不影響 guild 關聯訊息的檢索

  情境: 觸發訊息本身為 /clear 指令時直接退出
    假設使用者發送了一則以 "/clear" 開頭的訊息
    當系統收到此訊息作為觸發事件
    那麼系統必須立即返回成功狀態
    而且不執行 Agent session
    而且不發送任何回覆
    而且不建立或修改 workspace
    因為這只是一個指令而非需要回應的對話
